<extend name="Common@Manage:main"/>
<block name="content">
    <style>
        #tool_bar{
            display: none;
        }
        #tool_bar a{
            margin-left: 10px;
        }
    </style>
    <!-- 顶部 -->
    <blockquote class="layui-elem-quote" style="padding: 10px;">
        <div class="layui-row">
            <!-- 添加 -->
            <div class="layui-col-md9">

                <div class="layui-inline" style="line-height: 32px;">
                    <button class="layui-btn layui-btn-sm" onclick="showBoxs('新增院校','/yuanxiao/showAddYuanXiao',50,60)"><i class="layui-icon">&#xe608;</i> 新增院校</button>
                    <!--<button class="layui-btn layui-btn-sm"><i class="layui-icon">&#xe608;</i> <a href="/contents/create">新增分类</a></button>-->
                </div>
                <script>
                    function showBoxs(title,url,w,h){
                        if (title == null || title == '') {
                            title=false;
                        };
                        if (url == null || url == '') {
                            url="404.html";
                        };
                        if (w == null || w == '') {
                            w=($(window).width()*0.9);
                        };
                        if (h == null || h == '') {
                            h=($(window).height() + 50);
                        };
                        layer.open({
                            type: 2,
                            // area: [w+'px', h +'px'],
                            area: [75+'%', 70 +'%'],
                            fix: false, //不固定
                            // maxmin: true,
                            shadeClose: true,
                            shade:0.4,
                            title: title,
                            content: url
                        });
                    }
                </script>

                <!-- 操作工具栏 -->
                <div id="tool_bar" class="layui-inline">
                    <a id="edit" href="javascript:;">编辑</a>
                    <!--<a class="change_user_status" id="status2true" href="javascript:;">显示</a>-->
                    <!--<a class="change_user_status" id="status2false" href="javascript:;">隐藏</a>-->
                    <a id="del" href="javascript:;">删除</a>
                </div>
            </div>
            <!-- 搜索 -->
            <div class="layui-col-md3" style="text-align: right;">
                <div id="table_search" class="">
                    <div class="layui-inline" style="width: 40%">
                        <select name="attribute" id="attribute" lay-verify="required" class="layui-input search-input" >
                            <option value="">选择学校类型</option>
                            <option value="国立">国立</option>
                            <option value="公立">公立</option>
                            <option value="私立">私立</option>
                        </select>
                    </div>
                    <div class="layui-inline">
                        <input class="layui-input search-input" placeholder="请输入学校名" name="name" id="search_key" autocomplete="off">
                    </div>

                    <button class="layui-btn layui-btn-sm" data-type="reload">搜索</button>
                </div>
            </div>
            <!--&lt;!&ndash; 搜索 &ndash;&gt;-->
            <!--<div class="layui-col-md7" style="text-align: right;">-->
            <!--<a href="/call" class="layui-btn layui-btn-normal layui-btn-sm"><i class="layui-icon">&#xe613;</i> 名师列表</a>-->
            <!--<a href="/call/student" class="layui-btn layui-btn-normal layui-btn-sm"><i class="layui-icon">&#xe66f;</i> 学员列表</a>-->
            <!--<a href="/call/log" class="layui-btn layui-btn-normal layui-btn-sm"><i class="layui-icon">&#xe60a;</i> 打Call记录</a>-->
            <!--<div id="table_search" class="" style="display: inline-block;">-->
            <!--<div class="layui-inline">-->
            <!--<input class="layui-input search-input" placeholder="请输入老师姓名" name="name" id="search_key" autocomplete="off">-->
            <!--</div>-->
            <!--<button class="layui-btn layui-btn-sm" data-type="reload">搜索</button>-->
            <!--</div>-->
            <!--</div>-->
        </div>
    </blockquote>

    <table id="lists" lay-filter="data"></table>
    <!-- 隐藏域 用于暂存要编辑和删除的数据ids -->
    <input type="hidden" id="check_ids">
    <script src="/Public/jquery.min.js"></script>
    <script>
        $(function () {
            var _more;
            layui.use(['table','layer'], function(){
                var table = layui.table,
                    layer = layui.layer;
                // 表格实例
                table.render({
                    elem: '#lists',// DOM ID
                    // height: 315,// 高度
                    url: '/yuanxiao/search',// 数据接口
                    page: true,// 开启分页
                    cols: [[ // 表头 (列显示)
                        {type:'checkbox',fixed: 'left'},
                        // {field: 'id', title: 'ID', sort: true},
//                        {field: 'id', title: '学校id'},
                        {field: 'name', title: '院校名称(中文)'},
                        {field: 'englishname', title: '院校名称(英文)'},
                        {field: 'category', title: '类型',templet:function(d){
                            console.log(_more)
                                return _more.category[d.category]
                            }},
                        {field: 'attribute', title: '属性',templet:function(d){
                                return _more.property[d.attribute]
                            }},
                        {field: '', title: '学校介绍信息',templet:'#abc'},
//                        {field: '', title: '关键词',templet:function(d){
//                                return  '<button class="layui-btn layui-btn-sm layui-btn-danger">关键词</button>'
//                            }},
//                        {field: 'phone', title: '招生联系人'},
//                        {field: 'email', title: '邮箱'},
//                        {field: 'update_user', title: '更新者'},
//                        {field: 'update_time', title: '更新时间'},
//                        {field: 'status', title: '状态', sort: true,fixed: 'right',templet: '#status'}
                    ]],
                    id:'lists',// 起别名 (方便表格重载)
                    text: {
                        none: '暂无相关数据' // 默认：无数据
                    },
                    before:function (res) {
                        _more = res.more;
                    }
                });
                // 表格重载 条件搜索
                var $ = layui.$,active = {
                    reload: function(){
                        var search_key = $('#search_key');
                        var attribute = $('#attribute');
                        //执行重载
                        table.reload('lists', {
                            page: {
                                curr: 1 // 重新从第 1 页开始
                            },
                            where: {
                                search_key: search_key.val(),// 搜索条件
                                attribute:attribute.val()
                            }
                        });
                    }
                };
                // 点击搜索按钮触发表格重载事件
                $('#table_search .layui-btn').on('click', function(){
                    var type = $(this).data('type');
                    active[type] ? active[type].call(this) : '';
                });
                // 搜索框添加回车搜索事件
                $("#search_key").keyup(function (e) {
                    var curKey = e.which;
                    if (curKey == 13) {
                        var type = $('#table_search .layui-btn').data('type');
                        active[type] ? active[type].call(this) : '';
                    }
                });
                // -------------------- 数据操作 --------------------
                // 监听表格复选框选择
                table.on('checkbox(data)', function(obj){
                    // console.log(obj)
                    // 获取当前选中元素
                    var checkStatus = table.checkStatus('lists')
                        ,data = checkStatus.data;

                    // 如果选中
                    if(data.length > 0){
                        // 选中数量不为空,则显示操作工具栏
                        $('#tool_bar').css("display","inline-block");
                        $('#edit').show();// 显示编辑按钮
                        // 选中多个,则隐藏编辑按钮
                        if(data.length > 1){$('#edit').hide();}
                        // 声明暂存当前选中元素 ids 的变量
                        var ids = '';
                        // 拼接选中的ids
                        for (var i=0;i<data.length;i++) {ids += ',' + data[i].id;}
                        // 将当前选中元素的 id 暂存在隐藏域中
                        $('#check_ids').val(ids);
                    }else{
                        $('#check_ids').val('');// 清空暂存的ids
                        $('#tool_bar').hide();// 隐藏操作工具栏
                    }
                });
                // 编辑事件
                $('#edit').click(function () {
                    // 获取当前选中数据的ids
                    var edit_id = $('#check_ids').val();
                    showBoxs('编辑院校','/yuanxiao/showEditYuanXiao?id='+edit_id,50,70);
//                    alert(edit_id)


                });
                // 删除事件
                $('#del').click(function () {

                    // 确认框
                    layer.confirm("确认要删除吗，删除后不能恢复!", { title: "提示:",icon: 0 }, function (index) {
                        layer.close(index);

                        // 获取当前选中数据的ids
                        var del_ids = $('#check_ids').val();
                        // 发起请求
                        $.ajax({
                            type:"POST",
                            url:"/yuanxiao/deleteYuanXiao",
                            dataType:'JSON',
                            data:{
                                ids:del_ids,
                            },
                            success:function (res) {
                                if (res.status == 1) {
                                    layer.alert('删除成功!');
                                }else{
                                    layer.alert(res.msg);
                                }
                            }
                        });
                    });

                });

                // 修改状态
                $('.change_user_status').click(function () {

                    var send_data = {};

                    if ($(this).attr("id") == 'status2true'){
                        send_data.target_status = 1;
                    }

                    // 获取当前选中数据的ids
                    var del_ids = $('#check_ids').val();
                    send_data.ids = del_ids;

                    // 发起请求
                    $.ajax({
                        type:"POST",
                        url:"/call/teacher/changestatus",
                        dataType:'JSON',
                        data:send_data,
                        success:function (res) {
                            if (res.status == 1) {
                                layer.alert('修改成功!');
                            }else{
                                layer.alert(res.msg);
                            }
                        }
                    });

                });

            });
            // out code...

        });
    </script>
    <script type="text/html" id="aaa">
        <font class="1">{{data.more[d.category]}}</font>
    </script>
    <script type="text/html" id="abc">
         <button class='layui-btn layui-btn-sm' onclick="showBoxs('学校介绍信息','/yuanxiao/showInfoYuanXiao?id={{d.id}}' ,50,60)">学校介绍信息</button>
    </script>

    <!-- 状态模板 -->
    <script type="text/html" id="status">
        {{#  if(d.status == 1){ }}
        <font class="status_true">显示</font>
        {{#  } else { }}
        <font class="status_false">隐藏</font>
        {{#  } }}
    </script>

    <!-- 图片模板 -->
    <script type="text/html" id="tableimg">
        {{#  if(d.avatar!=0){ }}
        <img src="{{ d.avatar }}" alt="{{ d.avatar }}">good
        {{#  } else { }}
        <font class="status_false">图片未上传</font>
        {{#  } }}
    </script>

    <!-- 图片模板 -->
    <script type="text/html" id="tableimg2">
        {{#  if(d.good != 0){ }}
        <img src="{{ d.good }}" alt="{{ d.good }}">
        {{#  } else { }}
        <font class="status_false">图片未上传</font>
        {{#  } }}
    </script>


    <script type="text/html" id="faceimg">
        {{#  if(d.good != 0){ }}
        <img src="{{ d.faceimg }}" alt="{{ d.faceimg }}">
        {{#  } else { }}
        <font class="status_false">图片未上传</font>
        {{#  } }}
    </script>

</block>